---

- name: Install Windows Updates
  win_updates:
    category_names: "{{ patching_windows_categories }}"
    state: installed
    reboot: "{{ patching_windows_reboot }}"
    reboot_timeout: 600
  when: "{{ patching_windows_update_allowed }}"
  register: win_update_result
  changed_when:
    - win_update_result.installed_update_count is defined
    - win_update_result.installed_update_count > 0
  failed_when:
    - win_update_result.failed_update_count is defined
    - win_update_result.failed_update_count > 0